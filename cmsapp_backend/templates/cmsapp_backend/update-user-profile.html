{% extends 'cmsapp_backend/backend_base.html' %}
{% load static %}
{% block content %}

<header class="bg-primary text-white py-3 mb-4">
    <div class="container">
      <h4 class="mb-0"><i class="bi bi-list-check"></i> แก้ไขข้อมูลโปรไฟล์</h4>
    </div>
</header>

<section class="section profile">
    {% if user.is_authenticated %}
    <div class="row">

        <!-- Profile Summary Card -->
        <div class="col-xxl-4 col-md-5 mb-4">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        ชื่อผู้ใช้งาน: <span class="text-primary">{{ user.first_name }} {{ user.username }}</span>
                    </h5>
                    <div class="rounded-circle mx-auto d-flex justify-content-center mt-3">
                        <img id="preview" 
                             src="{{ user.profileuser.photo.url|default:'/static/images/default.png' }}" 
                             alt="Profile Image" 
                             class="rounded-circle border border-2" 
                             style="width:150px; height:150px; object-fit:cover;" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Edit Form -->
        <div class="col-xxl-8 col-md-7">
            <div class="card shadow-sm">
                <div class="card-body pt-4">
                    <h5 class="card-title">แก้ไขข้อมูล</h5>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} text-center mt-3">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}

                        <div class="table-responsive">
                            <table class="table table-borderless align-middle">
                                {{ updateUser.as_table }}
                            </table>
                        </div>

                        <div class="text-end mt-3">
                            <button type="submit" class="btn btn-warning px-4">
                                <i class="ri-tools-fill me-1"></i> บันทึกข้อมูล
                            </button>
                        </div>
                    </form>

                </div>
            </div>
        </div>

    </div>
    {% endif %}
</section>

<!-- รูป preview script -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById('id_photo');
    const preview = document.getElementById('preview');

    if (fileInput) {
        fileInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = "/static/images/default.png";
            }
        });
    }
});
</script>


{% endblock content %}
