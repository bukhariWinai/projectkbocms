{% extends 'cmsapp/base.html' %}
{% load static %}
{% block content %}
<!-- ======= Breadcrumbs ======= -->
<div class="breadcrumbs">
  <div class="page-header d-flex align-items-center" style="background-image: url('');">
    <div class="container position-relative">
      <div class="row d-flex justify-content-center">
        <div class="col-lg-6 text-center">
          <h2>เอกสาร / แบบฟอร์ม</h2>
          <p>สำนักงานสาธารณสุขจังหวัดกระบี่</p>
        </div>
      </div>
    </div>
  </div>
  <nav>
    <div class="container">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home_page' %}">Home</a></li>
        <li class="breadcrumb-item active">เอกสาร / แบบฟอร์ม</li>
      </ol>
    </div>
  </nav>
</div>
<!-- End Breadcrumbs -->

<main id="main">
  <section id="contact" class="contact">
    <div class="container" data-aos="fade-up">
      <div class="row gx-lg-0 gy-4">
        <div class="col-lg-12">
          <div class="my-3 p-4 bg-white rounded shadow-lg">

            <!-- Search Box + Category Dropdown -->
            <div class="d-flex justify-content-end mb-3">
              <form method="get" class="d-flex">
                <input type="text" name="q" class="form-control me-2" placeholder="ค้นหาเรื่อง/กลุ่มงาน/ผู้ประกาศ" value="{{ q }}">

                <select name="category" class="form-select me-2">
                <option value="8">เอกสาร/แบบฟอร์ม</option>
                        {% for cat in categories %}
                <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == category_id %}selected{% endif %}>
                      {{ cat.categ }}
                </option>
                    {% endfor %}
                </select>

                <button class="btn btn-outline-primary" type="submit">
                  <i class="bi bi-search"></i>
                </button>
              </form>
            </div>

            <!-- แสดงจำนวนผลลัพธ์ -->
            {% if q or category_id %}
            <p class="text-muted">พบทั้งหมด {{ total_results }} รายการ</p>
            {% endif %}

            <!-- Table -->
            <div class="table-responsive">
              <table class="table table-hover table-striped align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col"><i class="bi bi-clock me-1"></i>วันที่</th>
                    <th scope="col"><i class="bi bi-card-text me-1"></i>เรื่อง</th>
                    <th scope="col"><i class="bi bi-diagram-3 me-1"></i>กลุ่มงาน</th>
                    <th scope="col"><i class="bi bi-diagram-3 me-1"></i>หมวดหมู่</th>
                    <th scope="col"><i class="bi bi-paperclip me-1"></i>ไฟล์</th>
                    <th scope="col"><i class="bi bi-person-fill me-1"></i>ผู้ประกาศ</th>
                  </tr>
                </thead>
                <tbody>
                  {% for i in download %}
                  <tr>
                    <td><small><i class="bi bi-clock me-1 text-primary"></i>{{ i.postdate|date:"d/m/Y" }}</small></td>
                    <td>
                      <a href="{% url 'docdetails_page' i.id %}" class="text-decoration-none">
                        <i class="bi bi-file-earmark-text me-1 text-info"></i><strong>{{ i.title }}</strong>
                      </a>
                    </td>
                    <td><small><i class="bi bi-diagram-3 me-1 text-secondary"></i>{{ i.section }}</small></td>
                    <td><small><i class="bi bi-card-text me-1"></i>{{ i.category }}</small></td>
                    <td>
                      <a href="{{ i.file.url }}" target="_blank" class="text-success" title="ดาวน์โหลดไฟล์">
                        <i class="bi bi-download fs-5"></i>
                      </a>
                    </td>

                    <td><small><i class="bi bi-person-circle me-1 text-dark"></i>{{ i.user }}</small></td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="6" class="text-center text-muted">ไม่พบข้อมูล</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>

            <!-- Pagination -->
            {% if download.has_other_pages %}
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center">
                {% if download.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ download.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">«</a>
                  </li>
                {% else %}
                  <li class="page-item disabled"><span class="page-link">«</span></li>
                {% endif %}

                {% for num in download.paginator.page_range %}
                  {% if download.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                  {% else %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ num }}{% if q %}&q={{ q }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">{{ num }}</a>
                    </li>
                  {% endif %}
                {% endfor %}

                {% if download.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ download.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if category_id %}&category={{ category_id }}{% endif %}">»</a>
                  </li>
                {% else %}
                  <li class="page-item disabled"><span class="page-link">»</span></li>
                {% endif %}
              </ul>
            </nav>
            {% endif %}

          </div>
        </div>
      </div>
    </div>
  </section>
</main>

{% endblock content %}
